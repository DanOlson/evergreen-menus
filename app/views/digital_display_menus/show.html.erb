<% orientation = @digital_display_menu.horizontal_orientation? ? 'horizontal' : 'vertical' %>
<div class="digital-display-menu-container">
  <% @digital_display_menu.lists.each do |list| %>
    <% list_class = list.beers.count > 8 && orientation == 'horizontal' ? 'two-column-list' : 'one-column-list' %>
    <div class="card" id="card-<%= list.id %>">
      <div 
        class="digital-display-menu-list center-block <%= list_class %> <%= orientation %>"
        data-test="digital-display-menu-list">

        <h4 class="list-title" data-test="digital-display-menu-list-name"><%= list.name %></h4>

        <div class="list-container">
          <ul class="<%= list_class %>">
          <% list.beers.each do |beer| %>
            <li data-test="digital-display-menu-list-item">
              <span data-test="digital-display-menu-list-item-name"><%= beer.name %></span>
              <% if list.show_price_on_menu %>
                <span class="pull-right" data-test="digital-display-menu-list-item-price">
                  <%= number_to_currency beer.price %>
                </span>
              <% end %>
            </li>
          <% end %>
          </ul>
        </div>
      </div>
    </div>
  <% end %>
</div>

<% content_for :head do %>
  <% font = @digital_display_menu.font %>
  <link
    rel="stylesheet"
    type="text/css"
    href="//fonts.googleapis.com/css?family=<%= font.gsub(' ', '+') %>"
  />
  <style>
    body {
      background-color: <%= @digital_display_menu.background_color %>;
      color: <%= @digital_display_menu.text_color %>;
      font-family: <%= font %>;
    }

    .list-title {
      color: <%= @digital_display_menu.list_title_color %>;
    }
  </style>
<% end %>

<script>
  var ids = <%= raw @digital_display_menu.lists.map(&:id) %>;
  var rotationInterval = <%= @digital_display_menu.rotation_interval %>;
  function showNext() {
    var idToShow = ids[0];
    var lists = document.getElementsByClassName('card');
    var el = document.getElementById('card-' + idToShow);
    for (var i = 0; i < lists.length; i++) {
      lists[i].classList.remove('flipped');
    }
    if (el) {
      el.classList.add('flipped');
      ids.unshift(ids.pop());
    }
  }
  showNext();
  setInterval(showNext, parseInt(rotationInterval, 10));
</script>
